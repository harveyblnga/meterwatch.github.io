<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consumer Energy Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GVRPV64YPR"></script>
    <style>
        :root {
            --primary: #c74e20;
            --secondary: #3c3251;
            --background: #f8f9fa;
            --foreground: #333;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            padding-top: 56px; /* Account for fixed navbar */
        }
        .navbar {
            background-color: var(--secondary);
        }
        .navbar-brand, .nav-link {
            color: #fff !important;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: var(--primary);
            color: #fff;
        }
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(0, 0, 0, 0.05);
        }
        .month-selector {
            max-width: 200px;
            margin-bottom: 1rem;
        }
    </style>
    <style>
        /* Add this to your existing styles */
        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(255, 255, 255, 0.8)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }
        
        .navbar-toggler {
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .navbar-toggler:focus {
            box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.2);
        }
    </style>
      <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
      <link rel="manifest" href="site.webmanifest">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">Meter Watch </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Energy Reports</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Loadshedding.html">LoadShedding Calendar</a>
                    </li>
                    <li class="nav-item">
                        <!--<a class="nav-link" href="#days-between">Days Between Purchases</a>-->
                    </li>
                    <li class="nav-item">
                        <!--<a class="nav-link" href="#summary">Summary</a>-->
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
   

        <section id="hourly-purchases">
            <div class="card">
                <div class="card-header">
                    <h2>Token Purchase Rhythm: A 24-Hour Analysis</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <select id="hourlyPurchasesMonth1" class="form-select month-selector">
                                <option value="0">September</option>
                                <option value="1" selected>October</option>
                                <option value="2">November</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select id="hourlyPurchasesMonth2" class="form-select month-selector">
                                <option value="0">September</option>
                                <option value="1" >October</option>
                                <option value="2"selected>November</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="hourlyPurchasesChart"></canvas>
                    <p>In October, the hourly purchases show a more consistent pattern, with a slight increase in activity towards the end of the month. The overall trend is relatively stable, with no significant spikes or dips. This suggests that consumers were able to maintain a regular buying schedule, likely due to improved electricity availability and a better understanding of the load-shedding schedule. The consistent pattern throughout the month indicates that households were able to adapt to the new routine, making more frequent purchases as needed.</p>
                </div>
            </div>
        </section>

        <section id="token-range">
            <div class="card">
                <div class="card-header">
                    <h2>Sweet Spot Identified: A Deep Dive into Token Purchase Preferences</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <select id="tokenRangeMonth1" class="form-select month-selector">
                                <option value="0">September</option>
                                <option value="1" selected>October</option>
                                <option value="2">November</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select id="tokenRangeMonth2" class="form-select month-selector">
                                <option value="0">September</option>
                                <option value="1" selected>October</option>
                                <option value="2" selected>November</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="tokenRangeChart"></canvas>
                    <p>The token range distribution shows the frequency of purchases within different value ranges, helping to understand consumer purchasing patterns and preferences in token denominations.</p>
                </div>
            </div>
        </section>

        <section id="daily-purchases">
            <div class="card">
                <div class="card-header">
                    <h2>Token Purchases Surge on the 1st, Reflecting Monthly Reset and Discounts</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <select id="dailyPurchasesMonth1" class="form-select month-selector">
                                <option value="0">September</option>
                                <option value="1" selected>October</option>
                                <option value="2">November</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select id="dailyPurchasesMonth2" class="form-select month-selector">
                                <option value="0">September</option>
                                <option value="1" >October</option>
                                <option value="2"selected>November</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="dailyPurchasesChart"></canvas>
                    <p>In November, the daily purchases reveal a subdued and steady pattern, influenced heavily by power cuts that persisted throughout the month. Unlike October, there is no significant early-month surge, suggesting that households were less incentivized or able to make large early purchases, possibly due to uncertainties about electricity availability. The consistent low-level consumption pattern, with occasional minor peaks, likely reflects ad-hoc purchases made to replenish electricity only when necessary. The power cuts appear to have disrupted regular buying habits, limiting the need or ability for frequent token purchases and aligning spending more closely with actual electricity usage. This reflects the impact of infrastructural challenges on consumer behavior.</p>
                </div>
            </div>
        </section>

        <!--<section id="days-between">
            <div class="card">
                <div class="card-header">
                    <h2>Days Between Purchases</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <select id="daysBetweenMonth1" class="form-select month-selector">
                                <option value="0">September</option>
                                <option value="1" selected>October</option>
                                <option value="2">November</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select id="daysBetweenMonth2" class="form-select month-selector">
                                <option value="0">September</option>
                                <option value="1" selected>October</option>
                                <option value="2">November</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="daysBetweenChart"></canvas>
                    <div class="table-responsive mt-4">
                        <table class="table table-striped" id="daysBetweenTable">
                            <thead>
                                <tr>
                                    <th>Meter Number</th>
                                    <th id="daysBetweenMonth1Header">October</th>
                                    <th id="daysBetweenMonth2Header">November</th>
                                    <th>Percentage Difference</th>
                                </tr>
                            </thead>
                            <tbody>
                                -- Table data will be populated by JavaScript --
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>-->

        <!--<section id="summary">
            <div class="card">
                <div class="card-header">
                    <h2>Summary</h2>
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th id="summaryMonth1Header">October</th>
                                <th id="summaryMonth2Header">November</th>
                                <th>Percentage Difference</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Average Days Between Purchases</td>
                                <td id="month1Avg"></td>
                                <td id="month2Avg"></td>
                                <td id="avgDiff"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>-->

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample data for all months
        const monthlyData = [
            {  tokenValue: 0,hourlyPurchases: [5,2,2,1,1,4,6,11,5,8,9,13,8,9,10,10,9,13,12,15,13,6,2,1],dailyPurchases: [6,1,0,3,9,6,11,7,7,9,10,9,12,10,8,12,6,8,12,13,6,9,5,2,0] 
                ,tokenRange:[0,41,21,20,10,15,7,11,7,5,2,9,1,5,3,4,1,0,1,5,6]            },

            { tokenValue: 10.93, hourlyPurchases: [6,1,0,3,9,6,11,7,7,9,10,9,12,10,8,12,6,8,12,13,6,9,5,2,0], dailyPurchases: [31,10,7,11,4,5,2,4,4,4,4,1,1,4,5,5,4,6,5,5,6,3,4,9,2,5,4,8,6,9,3] 
                ,tokenRange:[0,44,42,30,24,16,8,7,2,2,0,3,0,0,1,0,0,2,0,0]          },

            { tokenValue: 11.48, hourlyPurchases: [3,4,4,4,2,8,8,9,16,9,13,4,13,6,8,8,11,12,9,8,9,8,6,4], dailyPurchases: [37,7,10,9,7,8,5,4,2,5,5,3,5,1,2,1,3,3,3,7,6,4,4,4,5,5,11,7,7,6] 
                ,tokenRange:[5,15,12,10,19, 8, 7, 3, 9, 5,8, 2, 9, 3, 6, 1, 5, 1, 6,52]
            }
        ];

        const daysBetweenPurchasesData = [
            { meter: "Meter 1", data: [7.2, 7.5, 7.8, 8.1, 8.4, 8.7, 9.0, 9.3, 9.6, 6.8, 7.1, 7.4] },
            { meter: "Meter 2", data: [8.5, 8.8, 9.1, 9.4, 9.7, 10.0, 10.3, 10.6, 10.9, 7.9, 8.2, 8.5] },
            { meter: "Meter 3", data: [6.9, 7.2, 7.5, 7.8, 8.1, 8.4, 8.7, 9.0, 9.3, 7.1, 7.4, 7.7] },
            { meter: "Meter 4", data: [9.1, 9.4, 9.7, 10.0, 10.3, 10.6, 10.9, 11.2, 11.5, 8.3, 8.6, 8.9] },
            { meter: "Meter 5", data: [7.8, 8.1, 8.4, 8.7, 9.0, 9.3, 9.6, 9.9, 10.2, 7.5, 7.8, 8.1] }
        ];

        let  hourlyPurchasesChart, dailyPurchasesChart, tokenRangeChart;

     

        function updateHourlyPurchasesChart() {
            const month1 = parseInt(document.getElementById('hourlyPurchasesMonth1').value);
            const month2 = parseInt(document.getElementById('hourlyPurchasesMonth2').value);
            const chartData = {
                labels: Array.from({length: 24}, (_, i) => i),
                datasets: [
                    {
                        label: getMonthName(month1),
                        data: monthlyData[month1].hourlyPurchases,
                        borderColor: '#c74e20',
                        backgroundColor: 'rgba(199, 78, 32, 0.2)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: getMonthName(month2),
                        data: monthlyData[month2].hourlyPurchases,
                        borderColor: '#3c3251',
                        backgroundColor: 'rgba(60, 50, 81, 0.2)',
                        fill: true,
                        tension: 0.4
                    }
                ]
            };
            hourlyPurchasesChart.data = chartData;
            hourlyPurchasesChart.options.plugins.title.text = `Hourly Token Purchases Comparison`;
            hourlyPurchasesChart.update();
        }

        function updateDailyPurchasesChart() {
            const month1 = parseInt(document.getElementById('dailyPurchasesMonth1').value);
            const month2 = parseInt(document.getElementById('dailyPurchasesMonth2').value);
            const chartData = {
                labels: Array.from({length: 31}, (_, i) => i + 1),
                datasets: [
                    {
                        label: getMonthName(month1),
                        data: monthlyData[month1].dailyPurchases,
                        borderColor: '#c74e20',
                        backgroundColor: 'rgba(199, 78, 32, 0.2)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: getMonthName(month2),
                        data: monthlyData[month2].dailyPurchases,
                        borderColor: '#3c3251',
                        backgroundColor: 'rgba(60, 50, 81, 0.2)',
                        fill: true,
                        tension: 0.4
                    }
                ]
            };
            dailyPurchasesChart.data = chartData;
            dailyPurchasesChart.options.plugins.title.text = `Daily Token Purchases Comparison`;
            dailyPurchasesChart.update();
        }

        /*function updateDaysBetweenChart() {
            const month1 = parseInt(document.getElementById('daysBetweenMonth1').value);
            const month2 = parseInt(document.getElementById('daysBetweenMonth2').value);
            const month1Data = daysBetweenPurchasesData.map(d => d.data[month1]);
            const month2Data = daysBetweenPurchasesData.map(d => d.data[month2]);
            const percentageDiff = month1Data.map((v, i) => ((month2Data[i] - v) / v * 100).toFixed(2));

            const chartData = {
                labels: daysBetweenPurchasesData.map(d => d.meter),
                datasets: [
                    {
                        label: getMonthName(month1),
                        data: month1Data,
                        backgroundColor: '#c74e20',
                    },
                    {
                        label: getMonthName(month2),
                        data: month2Data,
                        backgroundColor: '#3c3251',
                    },
                    {
                        label: 'Percentage Difference',
                        data: percentageDiff,
                        backgroundColor: '#6c757d',
                        type: 'line',
                        yAxisID: 'percentage'
                    }
                ]
            };
            daysBetweenChart.data = chartData;
            daysBetweenChart.update();

            updateDaysBetweenTable(month1, month2, month1Data, month2Data, percentageDiff);
            updateSummary(month1, month2, month1Data, month2Data);
        }*/

        function updateDaysBetweenTable(month1, month2, month1Data, month2Data, percentageDiff) {
            const tableBody = document.getElementById('daysBetweenTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            daysBetweenPurchasesData.forEach((d, i) => {
                let row = tableBody.insertRow();
                row.insertCell(0).textContent = d.meter;
                row.insertCell(1).textContent = month1Data[i].toFixed(2);
                row.insertCell(2).textContent = month2Data[i].toFixed(2);
                row.insertCell(3).textContent = `${percentageDiff[i]}%`;
            });
            document.getElementById('daysBetweenMonth1Header').textContent = getMonthName(month1);
            document.getElementById('daysBetweenMonth2Header').textContent = getMonthName(month2);
        }

        function updateSummary(month1, month2, month1Data, month2Data) {
            const month1Avg = (month1Data.reduce((a, b) => a + b, 0) / month1Data.length).toFixed(2);
            const month2Avg = (month2Data.reduce((a, b) => a + b, 0) / month2Data.length).toFixed(2);
            const avgDiff = ((month2Avg - month1Avg) / month1Avg * 100).toFixed(2);

            document.getElementById('month1Avg').textContent = month1Avg;
            document.getElementById('month2Avg').textContent = month2Avg;
            document.getElementById('avgDiff').textContent = `${avgDiff}%`;
            document.getElementById('summaryMonth1Header').textContent = getMonthName(month1);
            document.getElementById('summaryMonth2Header').textContent = getMonthName(month2);
        }

        function getMonthName(monthIndex) {
            const months = [ 'September', 'October', 'November'];
            return months[monthIndex];
        }

        function updateTokenRangeChart() {
            const month1 = parseInt(document.getElementById('tokenRangeMonth1').value);
            const month2 = parseInt(document.getElementById('tokenRangeMonth2').value);
            const chartData = {
                labels: Array.from({length: 20}, (_, i) => `${i*50}-${(i+1)*50}`),
                datasets: [
                    {
                        label: getMonthName(month1),
                        data: monthlyData[month1].tokenRange,
                        borderColor: '#c74e20',
                        backgroundColor: 'rgba(199, 78, 32, 0.2)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: getMonthName(month2),
                        data: monthlyData[month2].tokenRange,
                        borderColor: '#3c3251',
                        backgroundColor: 'rgba(60, 50, 81, 0.2)',
                        fill: true,
                        tension: 0.4
                    }
                ]
            };
            tokenRangeChart.data = chartData;
            tokenRangeChart.options.plugins.title.text = `Token Range Distribution Comparison`;
            tokenRangeChart.update();
        }

        document.addEventListener('DOMContentLoaded', () => {
            

            const hourlyPurchasesCtx = document.getElementById('hourlyPurchasesChart').getContext('2d');
            hourlyPurchasesChart = new Chart(hourlyPurchasesCtx, {
                type: 'line',
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Hour of Day'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Purchases'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return `Hour: ${context[0].label}:00`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Hourly Token Purchases'
                        }
                    }
                }
            });

            const dailyPurchasesCtx = document.getElementById('dailyPurchasesChart').getContext('2d');
            dailyPurchasesChart = new Chart(dailyPurchasesCtx, {
                type: 'line',
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Day of Month'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Purchases'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return `Day: ${context[0].label}`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Daily Token Purchases'
                        }
                    }
                }
            });

            /*const daysBetweenCtx = document.getElementById('daysBetweenChart').getContext('2d');
            daysBetweenChart = new Chart(daysBetweenCtx, {
                type: 'bar',
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Days Between Purchases'
                            }
                        },
                        percentage: {
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Percentage Difference'
                            }
                        }
                    }
                }
            });*/

            const tokenRangeCtx = document.getElementById('tokenRangeChart').getContext('2d');
            tokenRangeChart = new Chart(tokenRangeCtx, {
                type: 'line',
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Token Value Range (R)'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Purchases'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Token Range Distribution'
                        }
                    }
                }
            });


            updateHourlyPurchasesChart();
            updateDailyPurchasesChart();
            //updateDaysBetweenChart();
            updateTokenRangeChart();


            document.getElementById('hourlyPurchasesMonth1').addEventListener('change', updateHourlyPurchasesChart);
            document.getElementById('hourlyPurchasesMonth2').addEventListener('change', updateHourlyPurchasesChart);
            document.getElementById('dailyPurchasesMonth1').addEventListener('change', updateDailyPurchasesChart);
            document.getElementById('dailyPurchasesMonth2').addEventListener('change', updateDailyPurchasesChart);
            //document.getElementById('daysBetweenMonth1').addEventListener('change', updateDaysBetweenChart);
            //document.getElementById('daysBetweenMonth2').addEventListener('change', updateDaysBetweenChart);
            document.getElementById('tokenRangeMonth1').addEventListener('change', updateTokenRangeChart);
            document.getElementById('tokenRangeMonth2').addEventListener('change', updateTokenRangeChart);
        });
    </script>
</body>
</html>